# Классификатор Танцевальных Движений

Система распознавания и анализа танцевальных движений на основе ИИ для латиноамериканских танцев (Румба).

##  Возможности

- **Классификация движений**: Распознает 14 фигур латиноамериканских танцев
- **Анализ исполнения**: Оценивает технику, тайминг, баланс, динамику и позу
- **Визуальная обратная связь**: Создает видео с наложенными оценками и подсветкой ошибок
- **Текстовые отчеты**: Детальные отчеты с метриками и рекомендациями

##  Производительность модели

- **Точность**: 83.7% (обучено на 20% датасета)
- **Уверенность**: 80-90% на тестовых видео
- **Архитектура**: Hybrid TCN+GRU
- **Ожидаемая точность**: 85-92% на полном датасете

##  Установка

### Требования
- Python 3.8+
- PyTorch 2.0+
- OpenCV
- YOLOv8 (через ultralytics)

### Настройка

```bash
git clone https://github.com/YOUR_USERNAME/dance-movement-classifier.git
cd dance-movement-classifier

# Установка зависимостей
pip install -r requirements.txt
```

##  Быстрый старт

### Шаг 1: Извлечение поз из видео

```bash
cd dancepose
python scripts/run_pose.py --video your_dance_video.mp4 --output ../outputs/my_dance
```

**Результат:**
- `poses.jsonl` - Данные ключевых точек
- `overlay_*.mp4` - Видео с наложенным скелетом

### Шаг 2: Анализ танца

```bash
cd ..
python RUN_ANALYSIS.py outputs/my_dance
```

**Результат:**
- `REPORT.txt` - Детальный текстовый анализ (открывается автоматически)
- `analyzed_*.mp4` - Видео с оценками и подсветкой ошибок (открывается автоматически)

##  Объяснение результатов

### Текстовый отчет (`REPORT.txt`)

```
Figure: FootChange
Confidence: 89.6%

OVERALL SCORE: 85.2/100

DETAILED SCORES:
  Technique    [===============-----] 76.7/100  (good)
  Timing       [==============------] 71.9/100  (fair)
  Balance      [===================-] 97.8/100  (excellent)
  Dynamics     [====================] 100.0/100 (excellent)
  Posture      [===============-----] 79.7/100  (good)

ERRORS FOUND: 129

TOP 5 ERRORS:
  1. Time: 0.0s - BALANCE - Swaying (medium severity)
  2. Time: 0.1s - BALANCE - Swaying (medium severity)
  ...
```

### Видео результат (`analyzed_*.mp4`)

На видео отображается:
- Танцор с наложенным скелетом
- Название фигуры и уверенность (сверху)
- Все оценки метрик (левая панель)
- Цветные полоски (зеленый/желтый/красный)
- Подсветка ошибок в моменты их возникновения
- Красная рамка при критичных ошибках

##  Распознаваемые фигуры (14)

| Фигура | Описание |
|--------|----------|
| Aida | Открывающая позиция |
| Alemana | Поворотная фигура |
| Fan | Открытие в веерную позицию |
| FootChange | Базовая смена стопы |
| HandToHandL | Рука к руке влево |
| HandToHandR | Рука к руке вправо |
| HockyStick | Хоккейная клюшка |
| NaturalTop | Натуральный топ |
| NewYorkL | Нью-Йорк влево |
| NewYorkR | Нью-Йорк вправо |
| NotPerforming | Нейтральная/отдыхающая позиция |
| OpenBasic | Открытый базовый |
| OpeningOut | Открытие наружу |
| SpotTurn | Спот поворот |

##  Структура проекта

```
dance-movement-classifier/
├── dancepose/              # Извлечение поз (YOLOv8)
│   ├── scripts/
│   │   ├── run_pose.py    # Извлечение поз из видео
│   │   └── run_pose_async.py
│   └── yolo11x-pose.pt    # Модель YOLOv8 (не включена)
│
├── dance_classifier/       # Классификатор движений
│   ├── best_model_20pct_adapted.pth  # Обученная модель (не включена)
│   └── label_encoder.pkl   # Кодировщик меток
│
├── metrics_analyzer/       # Анализ исполнения
│   ├── technique.py
│   ├── timing.py
│   ├── balance.py
│   ├── dynamics.py
│   └── posture.py
│
├── reference_database/     # Референсные данные для фигур
│   └── Fan.json
│
├── RUN_ANALYSIS.py         # Главный скрипт анализа
├── analyze_dance.py        # Основная логика анализа
├── visualize_errors_on_video.py
├── save_text_report.py
├── use_classifier.py       # Обертка классификатора
└── requirements.txt
```

##  Как это работает

### 1. Извлечение поз
Использует YOLOv8-pose для определения 17 ключевых точек на каждом кадре:
- Нос, глаза, уши
- Плечи, локти, запястья
- Бедра, колени, лодыжки

### 2. Классификация движения
- Извлекает признаки из последовательности поз
- Использует архитектуру Hybrid TCN+GRU
- Выдает название фигуры и уверенность

### 3. Анализ исполнения

**Оцениваются пять метрик:**

1. **Техника (0-100)**: Точность углов в суставах относительно эталона
2. **Тайминг (0-100)**: Плавность движений, согласованность скорости
3. **Баланс (0-100)**: Стабильность центра тяжести
4. **Динамика (0-100)**: Амплитуда и энергия движений
5. **Поза (0-100)**: Выравнивание тела, угол позвоночника, положение головы

### 4. Обнаружение ошибок
- Сравнивает исполнение с референсной базой данных
- Определяет отклонения используя z-оценки
- Классифицирует серьезность (низкая/средняя/высокая)

### 5. Визуализация
- Накладывает оценки на видео
- Подсвечивает ошибки в точные моменты
- Цветная обратная связь

##  Для разработчиков

### Использование классификатора программно

```python
from use_classifier import classify_video

result = classify_video(
    "outputs/my_dance/poses.jsonl",
    model_path="dance_classifier/best_model_20pct_adapted.pth"
)

print(f"Фигура: {result['predicted_figure']}")
print(f"Уверенность: {result['confidence']:.1%}")
```

### Запуск полного анализа

```python
import subprocess

subprocess.run([
    "python", "RUN_ANALYSIS.py",
    "outputs/my_dance"
])
```

##  Важные примечания

### Не включено в репозиторий

Из-за ограничений размера файлов:

1. **Файл модели** (`best_model_20pct_adapted.pth` ~400KB)
   - Скачать с: [Ссылка на облачное хранилище]
   - Поместить в: `dance_classifier/`

2. **Модель YOLOv8** (`yolo11x-pose.pt` ~150MB)
   - Скачать с: [Ссылка на облачное хранилище]
   - Поместить в: `dancepose/`

3. **Обучающий датасет**
   - Видео не включены
   - Референсные данные включены для одной фигуры (Fan)

### Системные требования

- **RAM**: минимум 4GB (рекомендуется 8GB)
- **GPU**: Опционально, но рекомендуется для быстрой обработки
- **Диск**: 1GB свободного места (без учета хранения видео)

##  Решение проблем

### "Model file not found"
Скачайте файл модели и поместите его в директорию `dance_classifier/`.

### "YOLO model not found"
Скачайте `yolo11x-pose.pt` и поместите его в директорию `dancepose/`.

### Низкие оценки уверенности
- Убедитесь, что качество видео хорошее (720p+)
- Проверьте, что видно все тело
- Убедитесь, что фигура действительно из 14 распознаваемых типов

### Видео не открывается
Файлы создаются в той же папке, что и входные данные. Проверьте:
- `outputs/your_folder/REPORT.txt`
- `outputs/your_folder/analyzed_*.mp4`
